<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.co.iei.party.model.dao.PartyDao">

	<select id="getAllParties" resultType="party">
		SELECT
		party_no AS partyNo,
		party_type AS partyType,
		party_title AS partyTitle,
		party_content AS
		partyContent,
		party_place AS partyPlace,
		party_thumb AS partyThumb,
		party_date AS partyDate,
		party_male AS partyMale,
		party_female AS
		partyFemale,
		party_price AS partyPrice
		FROM party
		ORDER BY party_date
		DESC
	</select>

	<select id="getPartyByType" parameterType="string"
		resultType="party">
		SELECT
		party_no AS partyNo,
		party_type AS partyType,
		party_title AS partyTitle,
		party_content AS partyContent,
		party_place AS
		partyPlace,
		party_thumb AS partyThumb,
		party_date AS partyDate,
		party_male AS partyMale,
		party_female AS partyFemale,
		party_price AS
		partyPrice
		FROM party
		WHERE party_type = #{type}
		ORDER BY party_date DESC
	</select>

	<insert id="insertParty" parameterType="party">
		INSERT INTO party (
		party_no,
		party_type,
		party_title,
		party_content,
		party_place,
		party_thumb,
		party_date,
		party_male,
		party_female,
		party_price
		)
		VALUES (
		party_seq.NEXTVAL,
		#{partyType},
		#{partyTitle},
		#{partyContent},
		#{partyPlace},
		#{partyThumb},
		TO_DATE(#{partyDate}, 'YYYY-MM-DD
		HH24:MI'),
		#{partyMale},
		#{partyFemale},
		#{partyPrice}
		)
	</insert>

	<select id="getPartyById" parameterType="int"
		resultType="kr.co.iei.party.model.vo.Party">
		SELECT party_no, party_title, party_date, party_place,
		party_price, party_thumb, party_type, party_content, party_male,
		party_female
		FROM party
		WHERE party_no = #{partyNo}
	</select>

	<select id="selectPartyByNo" resultType="Party"
		parameterType="int">
		SELECT *
		FROM party
		WHERE party_no = #{partyNo}
	</select>

	<select id="selectPartyMemberCount" resultType="map"
		parameterType="int">
		SELECT
		SUM(CASE WHEN m.member_gender='m' THEN 1 ELSE 0
		END) AS male_count,
		SUM(CASE WHEN m.member_gender='f' THEN 1 ELSE 0
		END) AS female_count
		FROM party_member pm
		JOIN member m ON pm.member_id
		= m.member_id
		WHERE pm.party_no = #{partyNo}
	</select>

</mapper>
