<!DOCTYPE html>
<html xmlns:th="http://www.thyeleap.org">
<head>
<meta charset="UTF-8">
<title>DateBase join Form</title>
<link rel="stylesheet" href="../css/joinFrm.css">
</head>
<body>
	<th:block th:include="common/header"></th:block>
	<div class="joinFrm-all-wrap">
		<div class="joinFrm-header">
			<h1>회원가입</h1>
		</div>
		
		<form action="/member/join" method="post" enctype="multipart/form-data">
		<div class="joinFrm-content">
			<div class="joinFrm-input">
				<div class="join-input">
					<span>아이디<sup>*</sup></span>
					<input type="text" name="memberId" id="memberId">
				</div>
				<p class="input-msg idCheckResult"></p>
			</div>
			<div class="joinFrm-input">
				<span>비밀번호<sup>*</sup></span>
				<input type="password" name="memberPw" id="memberPw">
				<p class="pwRule">알파벳 8글자 이상 20글자 이하, 특수문자 포함(!,@,#,$,%)</p>
			</div>
			<div class="joinFrm-input">
				<div class="join-input">
					<span>비밀번호 확인<sup>*</sup></span>
					<input type="password" name="memberPwRe" id="memberPwRe">
				</div>
				<p class="pw-input-msg"></p>
			</div>
			<div class="joinFrm-input">
				<span>이름<sup>*</sup></span>
				<input type="text" name="memberName" id="memberName">
			</div>
			<div class="joinFrm-input">
				<span>전화번호<sup>*</sup></span>
				<input type="text" name="memberPhone" id="memberPhone" placeholder="ex) 010-0000-0000">
				<p class="input-msg Phone"></p>
			</div>
			<div class="joinFrm-input">
				<span>주소<sup>*</sup></span>
				<input type="text" name="memberAddr" id="memberAddr" readonly>
				<button type="button" id="search-addr">주소찾기</button>
			</div>
			<div class="joinFrm-input">
				<span>이메일<sup>*</sup></span>
				<input type="text" name="memberEmailF" id="memberEmailF">
				<span class="mail">@</span>
				<input class="box" id="domainTxt" type="text" name="domainTxt">
				<select class="box" id="domain-list" name="domain-list">
				  <option value="type">직접 입력</option>
				  <option value="naver.com">naver.com</option>
				  <option value="gmail.com">gmail.com</option>
				  <option value="hanmail.net">hanmail.net</option>
				  <option value="nate.com">nate.com</option>
				  <option value="kakao.com">kakao.com</option>
				</select>
			</div>
			<div class="mailCheck">
                    <span>인증코드<sup>*</sup></span>
                    <input type="text" name="codeCheck" id="codeCheck">
                    <button type="button" id="sendcode">코드받기</button>
                    <button type="button" id="checkBtn">인증하기</button>
                    <span class="mailCheck-result"></span>
                    <span class="timeCheck"></span>
            </div>
			<div class="joinFrm-input">
				<span>생년월일<sup>*</sup></span>
				<input type="date" name="birthDate" id="birthDate">
				<!-- 
				<select name="year" id="year">	1976 ~ 2005
				</select><span>년</span>
				<select name="month">
					<option th:each="month : ${#numbers.sequence(1,12)}" th:value="${month}" th:text="${month}">
				</select><span>월</span>
				<select name="date">
				<option th:each="date : ${#numbers.sequence(1,31)}" th:value="${date}" th:text="${date}">
				</select><span>일</span>
				 -->
			</div>
			<div class="joinFrm-input">
				<span>성별<sup>*</sup></span>
				<input type="radio" name="memberGender" id="m" class="memberGender" value="m">
				<label for="m">남자</label>
				<input type="radio" name="memberGender" id="f" class="memberGender" value="f">
				<label for="f">여자</label>
			</div>
			<div class="joinFrm-input">
				<span>직업<sup>*</sup></span>
				<select title="직업" name="memberJob" id="memberJob">
					<option value="">직업 선택</option>
					<option value="금융, 사무직">금융, 사무직</option>
					<option value="연구원, 엔지니어">연구원, 엔지니어</option>
					<option value="건축, 설계사">건축,설계사</option>
					<option value="간호, 의료 관련">간호, 의료관련</option>
					<option value="디자이너">디자이너</option>
					<option value="언론인">언론인</option>
					<option value="교사, 강사">교사, 강사</option>
					<option value="공무원, 공공기관 관련">공무원, 공공기관 관련</option>
					<option value="의사, 약사">의사, 약사</option>
					<option value="회계사 등 기타 전문직">회계사 등 기타 전문직</option>
					<option value="변호사, 법조인"> 변호사, 법조인</option>
					<option value="자영업, 사업자">자영업, 사업자</option>
					<option value="프리랜서">프리랜서</option>
					<option value="승무원, 항공관련">승무원, 항공관련</option>
					<option value="대학 교수">대학교수</option>
					<option value="서비스, 영업직">서비스, 영업직</option>
					<option value="학생, 대학원생">학생, 대학원생</option>
					<option value="기타">기타</option>
				</select>
			</div>
			<div class="joinFrm-input">
				<span>MBTI<sup>*</sup></span>
				<select title="MBTI" name="memberMBTI" id="memberMBTI">
					<option value="">MBTI 선택</option>
					<option value="ISTP">ISTP</option>
					<option value="ISFJ">ISFJ</option>
					<option value="INFJ">INFJ</option>
					<option value="INTJ">INTJ</option>
					<option value="ISTP">ISTP</option>
					<option value="ISFP">ISFP</option>
					<option value="INFP">INFP</option>
					<option value="INTP">INTP</option>
					<option value="ESTP">ESTP</option>
					<option value="ESFP">ESFP</option>
					<option value="ENFP">ENFP</option>
					<option value="ENTP">ENTP</option>
					<option value="ESTJ">ESTJ</option>
					<option value="ESFJ">ESFJ</option>
					<option value="ENFJ">ENFJ</option>
					<option value="ENTJ">ENTJ</option>
				</select>
			</div>
			<div class="joinFrm-input mPhoto">
                    <span>사진<sup>*</sup></span>
                    <input type="file" name="memberImg" id="memberImg" accept="image/*">
                    <input type="text" id="fakeInput" value="파일을 선택하세요." disabled>
                    <label for="memberImg" id="selectImg">파일선택</label>
              </div>
		</div>
		<div class="Btn-submit">
			<button type="button" class="btn-submit no">취소</button>
			<button type="submit" class="btn-submit ok">회원가입</button>
		</div>
		</form>
	</div>
	<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
	<script>
		$(".no").on("click", function(){
			location.href=("/");
		});
	
		$("#checkBtn").hide();
	
		const date = new Date();
		const year = `${date.getFullYear()}`;
		const fYear = `${date.getFullYear()-20}`;
		const pYear = `${date.getFullYear()-59}`;
		
		//console.log(year);
		//console.log(pYear);
		//console.log(fYear);
		$("#birthDate").attr("min", pYear+"-01-01");
		$("#birthDate").attr("max", fYear+"-12-31");
		const dateFormat = $("#birthDate").val();
		console.log(typeof dateFormat);
		/*for(let i = 0 ; i < 39 ; i++){
			const option = $("<option>");
			pYear++
			option.attr("value",pYear);
			option.text(pYear)
			$("#year").append(option);
			;
		}*/
	</script>
	
	<script>
		$("#search-addr").on("click", function(){
			new daum.Postcode({
		        oncomplete: function(data) {
		        	
		            const roadAddress = data.roadAddress;
		            const zonecode = data.zonecode;
		            //console.log($("#memberAddr").val(data.roadAddress));
		            //console.log(roadAddress);
		            //console.log(zonecode);
		           $("#memberAddr").attr("value", roadAddress);
		        }
		    }).open();
		});
		
		$("#domain-list").on("change", function(){
			const list =  $("#domain-list").val();
			console.log(list);
			if(list !== "type"){
				$("#domainTxt").attr("value", list);
				$("#domainTxt").attr("readonly", true);
			}else{
				$("#domainTxt").attr("value", "");
				$("#domainTxt").attr("readonly", false);
			}
		});
		
		let idCheck = false;
		$("#memberId").on("change", function(){
			const memberId = $("#memberId").val();
			
			const pwRange = /^.{6,15}$/;
			const pwRangea = /[a-z]/;
			const pwRangeNum = /[0-9]/;
			
			const result1 = pwRange.test(memberId);
			const result2 = pwRangea.test(memberId);
			const result3 = pwRangeNum.test(memberId);
			
			if(result1&&result2&&result3){
					$.ajax({
					url : "/member/idCheck",
					type : "get",
					data : {memberId : memberId},
					success : function(result){
						console.log(result);
						if(result === 0){
							$(".idCheckResult").text("사용가능한 아이디입니다.");
							$(".idCheckResult").css("color", "#25bd53");
							idCheck = true;
						} else if(result === 1){
							$(".idCheckResult").text("이미 사용중인 아이디입니다.");
							$(".idCheckResult").css("color", "var(--warning)");
							idCheck = false;
						}
					}
				});
			}else{
				$(".input-msg").text("6-15자 사이 소문자, 숫자 포함.");
				$(".input-msg").css("color", "var(--warning)");
				idCheck = false;
			}
			
		});
		
		$("#memberPwRe").on("keyup", function(){
			const inputPw = $("#memberPw").val();
			const inputPwRe = $("#memberPwRe").val();
			if(inputPw === inputPwRe){
				$(".pw-input-msg").text("비밀번호가 같습니다.");
				$(".pw-input-msg").css("color", "#25bd53");
			}else{
				$(".pw-input-msg").text("비밀번호를 확인해주세요.");
				$(".pw-input-msg").css("color", "var(--warning)");
			}
		});
		
		$("#memberImg").on("change", function(){
		    const imgPath = $("#memberImg").val();
		    $("#fakeInput").val(imgPath);
		});
		
		let mailCode = null;
		$("#sendcode").on("click", function(){
			const emailFront = $("#memberEmailF").val();
			const emailBack = $("#domainTxt").val();
			const emailFull = emailFront+"@"+emailBack;
			$.ajax({
				url : "/api/sendCode",
				data : {emailFull : emailFull},
				success : function(data){
					mailCode = data;
					$("#checkBtn").show();
					$(".timeCheck").show();
					$("#sendcode").hide();
					timeCheck();
				}
			});
		});
		
		let mailCheck = false;
		let intervalId = null;
		$("#checkBtn").on("click", function(){
			const inputCode = $("#codeCheck").val();
			if(mailCode === inputCode){
				$(".mailCheck-result").text("인증완료");
				$(".mailCheck-result").css("color","#25bd53");
				window.clearInterval(intervalId);
				mailCode = null;
				$(".timeCheck").empty();
				mailCheck = true;
			}else{
				$(".mailCheck-result").text("인증실패");
				$(".mailCheck-result").css("color","var(--warning)");
				mailCheck=false;
			}
		});
		
		function timeCheck(){
			$(".timeCheck").html("<span id='min' style='color : #E5BA73'>3</span> : <span id='sec' style='color : #E5BA73'>00</span>");
			window.setInterval(function(){
				const min = $("#min").text();
				const sec = $("#sec").text();
				if(sec === "00"){
					//현재 초가 00초면 분을 내리고 초를 59로 만듬
					if(min === "00"){
						window.clearInterval(intervalId);
						mailCode = null;
						$("mailCheck-result").text("시간 만료");
						$("mailCheck-result").css("color","var(--warning)");
						mailCheck = false;
					}else{
						const newMin = Number(min) - 1;
						$("#min").text(newMin);
						$("#sec").text(59);
					}
				}else{
					//현재 초가 00초가 아니면 초만 1 내림
					const newSec = Number(sec) - 1;
					if(newSec < 10){
						$("#sec").text("0"+newSec);
					}else{
						$("#sec").text(newSec);
					}
				}
			},1000);
		};
		
		let pwCheck = false;
		$("#memberPw").on("keyup", function(){
		    
		    const pwRange = /^.{8,20}$/;
		    const pwRangeA = /[A-Z]/;
		    const pwRangea = /[a-z]/;
		    const pwRangeNum = /[0-9]/;
		    const pwRangeO = /[!@#$%]/;
		    const inputPw = $("#memberPw").val();
		    const result1 = pwRange.test(inputPw);
		    const result2 = pwRangeA.test(inputPw);
		    const result3 = pwRangea.test(inputPw);
		    const result4 = pwRangeNum.test(inputPw);
		    const result5 = pwRangeO.test(inputPw);

		    if(result1&&result2&&result3&&result4&&result5){
		        $(".pwRule").text("사용가능한 비밀번호입니다.");
		        $(".pwRule").css("color","#25bd53");
		        pwCheck = true;
		    }else{
		        $(".pwRule").text("사용 불가능한 비밀번호입니다.");
		        $(".pwRule").css("color","var(--warning)");
		        pwCheck = false;
		    }
		});
		
		let phoneCheck = false;
		$("#memberPhone").on("change", function(){
			const phCheck = /^0\d{1,2}-\d{3,4}-\d{4}$/;
			const phoneValue = $("#memberPhone").val();
			const result = phCheck.test(phoneValue);
			if(result){
				phoneCheck = true;
				$(".Phone").empty();
			}else{
				$(".Phone").text("-를 포함하여 다시 입력해주세요");
				$(".Phone").css("color", "var(--warning)");
				phoneCheck = false;
			}
		});
		
		$(".ok").on("click", function(e){
			const Addr = $("#memberAddr").val();
			const EmailF = $("#memberEmailF").val();
			const Txt = $("#domainTxt").val();
			const Date = $("#birthDate").val();
			const Gender = $(".memberGender").val();
			const Job = $("#memberJob").val();
			const MBTI = $("#memberMBTI").val();
			const Img = $("#memberImg").val();
			
			/*if(idCheck&&mailCheck){
				alert("필수 항목을 확인해주세요");
				e.preventDefault();
			}
			*/
			if(!idCheck||!mailCheck||!pwCHeck||!phoneCheck||!Addr==""||EmailF==""||Txt==""||
					Date==""||Gender==""||JOb==""||MBTI==""||Img==""){
				alert("필수 항목을 확인해주세요");
				e.preventDefault();
			}
		});
	</script>
	
	<th:block th:include="common/footer"></th:block>
</body>
</html>