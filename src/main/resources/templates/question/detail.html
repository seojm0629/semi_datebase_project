<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<style>
@font-face {
    font-family: main2;
    src: url(../CSS/font/PyeongChang-Regular.ttf);
}
@font-face {
    font-family: mainB2;
    src: url(../CSS/font/PyeongChang-Bold.ttf);
}
:root{
    --color1 : #2B2B2B;/*검은 글씨색*/
    --color2 : #FAF8F1;/*푸터 배경색*/
    --color3 : #FAEAB1;/**/
    --color4 : #E5BA73;/*버튼색, 로고, 페이지 제목*/
    --color5 : #C58940;/*푸터 두꺼운 글씨, 선 그을때*/
    --color6 : #EAC88F;/*버튼 호버한 경우 색*/
    --color7 : #FF6868;/*경고색*/
    --color8 : #D9D9D9;/*취소버튼*/
}

*{
    margin: 0px;
    padding: 0px;
    color: #2B2B2B;
    font-family: mainB2;
}
.content-detail{
    width: 400px;
    margin: 0 auto;
    text-align: center;
    padding-bottom: 20px;
}
.content-detail>h2{
    color: var(--color4);
    margin-top: 30px;
}

.content-title-tbl{
	width: 905px;
	margin: 0 auto;
	border: 1px solid #ccc;
	border-spacing: 0;
}

.content-title-tbl>tbody>tr:nth-child(2)>td{
	text-align: center;
}
.content-title-tbl>tbody>tr{
	border-bottom: 1px solid #ccc;
}

.content-title-tbl>tbody>tr:first-child>th{
	height: 50px;
	font-size: 20px;
	background-color: #E5BA73;
	color: black;
	
}


.content-title-tbl>tbody>tr:nth-child(2){
	height: 50px;
	border-bottom: 1px solid #ccc;
}
.content-title-tbl>tbody>tr:nth-child(2)>th{
	background-color: #FAF8F1;
	font-size: 18px;
	border-bottom: 1px solid #ccc;
}
.content-title-tbl>tbody>tr:nth-child(2)>td{
	border-bottom: 1px solid #ccc;
}

.content-title-tbl>tbody>tr:nth-child(3)>th{
	height: 50px;
	background-color: #FAF8F1;
	font-size: 18px;
	border-bottom: 1px solid #ccc;
}
.content-title-tbl>tbody>tr:nth-child(3)>td{
	border-bottom: 1px solid #ccc;
}
.content-title-tbl>tbody>tr:nth-child(4){
	height: 300px;
}

.content-title-tbl>tbody>tr:last-child{
	text-align: center;
	height: 80px;
}
.content-title-tbl>tbody>tr:last-child>td{
	border-top: 1px solid #ccc;
}
[class^="btn-"] {
  cursor: pointer;
  font-size: 20px;
  padding: 9px 20px;
  border: none;
  border-radius: 5px;
  font-family: ns-b;
  text-align:center;
  box-sizing: border-box;
}
.btn-a:hover{
	background-color:  #C58940;
}
.btn-a {
  border: 1px solid #ccc;
  background-color: #E5BA73;
  color: #ffffff;
}
.btn-button {
  border: 1px solid #ccc;
  background-color: #D9D9D9;
  color: #ffffff;
}

.inputCommentBox{
	width: 900px;
	margin: 30px auto;
	height: 100px;
	
}
.inputCommentBox>form>ul>li{
	list-style-type: none;
}
.inputCommentBox>form>ul{
	display: flex;
}
.inputCommentBox>form>ul>li:first-child{
	width: 200px;
	text-align: center;
}
.inputCommentBox>form>ul>li:first-child>span{
	font-size: 100px;
	color: #D9D9D9;
}

.inputCommentBox>form>ul>li:nth-child(2){
	width: 500px;
	text-align: center;	
}

.inputCommentBox>form>ul>li:nth-child(2)>div>textarea{
	width: 100%;
	line-height: 40px;
	resize: none;
	margin-top: 10px;
}

.inputCommentBox>form>ul>li:nth-child(3){
	width: 200px;
	text-align: center;	
}
.inputCommentBox>form>ul>li:nth-child(3)>button{
	width: 100px;
	height: 80px;
	border-radius: 15px;
	border: none;
	background-color: #E5BA73;
	color: #ffffff;
	font-size: 25px;
	font-famliy: main2;
	font-weight: 900;
	margin-top: 10px;
}
.content-comment{
  width: 900px;
  margin: 0 auto;
  list-style: none;
  padding: 10px;
  border: 1px solid #ccc;
}
.first-textarea{
	padding-left: 15px;
	padding-top: 10px;
}
.first-textarea>textarea{
	padding-left: 10px;
	padding-top: 10px;
	resize: none;
	width: 650px;
	height: 150px;
	font-size: 20px;
	font-family: main2;
}

.posting-comment{
	width: 900px;
	margin: 0 auto;
	display: flex;
  	border-top: 2px solid #ccc;
  	list-style-type: none;
}
.posting-comment.reply > li:first-child {
  width: 20%;
}
.posting-comment > li:first-child {
  width: 15%;
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 100px;
  border: 1px solid #ccc;
  border-top : none;
}

.posting-comment>li:first-child>span{
	font-size: 100px;
	color: #ccc;
}
.posting-comment > li {
  border-bottom: 1px solid #ccc;
  border-right: 1px solid #ccc;
  box-sizing: border-box;
}
.posting-comment>li:first-chlid{
	border-bottom: none;
}
.posting-comment.reply > li:last-child {
  display: flex;
  flex-direction: column;
  width: 80%;
}
.posting-comment > li:last-child {
  display: flex;
  flex-direction: column;
  width: 85%;
}
.posting-comment > li:last-child > p {
  width: 100%;
  padding: 5px;
  box-sizing: border-box;
}
.posting-comment > li:last-child > .comment-info > span {
  padding: 0px 10px;
}
.posting-comment > li:last-child > .comment-info > span:not(:last-child) {
  border-right: 2px solid #ccc;
}
.posting-comment > li:last-child > .comment-content {
  padding: 0px 15px;
}
.posting-comment > li:last-child > .comment-link {
  text-align: right;
}
.posting-comment > li:last-child > .comment-link > a {
  margin: 0px 5px;
}
.posting-comment > li:last-child > .comment-link > a:hover {
  text-decoration: underline;
}
.posting-comment.reply > li:first-child .material-icons:first-child {
  font-size: 40px;
  color: #ccc;
}
.posting-comment.reply > li:last-child {
  display: flex;
  flex-direction: column;
  width: 80%;
}
</style>
<body>
	<th:block th:include="common/header"></th:block>
	<section class="content-question-main">
            <div class="content-detail">
                <h2>문의사항 상세보기</h2>
            </div>


			<table class="content-title-tbl">
				<!-- tr th:text="${q.questionTitle} 들어가야함-->
				<tr>
					<th colspan="4" th:text="${q.questionTitle}"></th>
				</tr>
				<tr>
					<th style="width:20%;">작성자</th>
					<td style="width:30%;" th:text="${q.questionWriter}"></td>
					<th style="width:20%;">작성일</th>
					<td style="width:30%;" th:text="${q.regDate}"></td>
				</tr>
				<tr>
					<th>첨부파일</th>
					<td colspan="3">
						<th:block th:each="file : ${q.fileList}">
							<img src="/image/file.png" style="width:16px;">
							<a th:href="@{/question/filedown(questionFileNo=${file.questionFileNo})}" th:text=${file.filename}></a>
							
						</th:block>
					</td>
				</tr>
				<tr>
					<td colspan="4">
						<div id="questionContent" th:utext="${q.questionContentBr}"></div>
					</td>
				</tr>
				<tr th:if="${session.member != null && session.member.memberId == q.questionWriter}">
					<td colspan="4">					
						<a class="btn-a" th:href="@{/question/updateFrm(questionNo=${q.questionNo})}">수정</a>
						<button class="btn-button" th:onclick="deleteQuestion([[${q.questionNo}]]);">삭제</button>
					</td>
				</tr>
			</table>
			
			<!-- 댓글 입력 -->
			<div class="inputCommentBox" th:if="${session.member != null}"> 
				<form action="/question/insertComment" method="post">
					<ul>
						<li>
							<span class="material-icons">account_box</span>
						</li>
						<li>
							<input type="hidden" name="questionCommentWriter" th:value="${session.member.memberId}" >
							<input type="hidden" name="questionRef" th:value="${q.questionNo}">
							<div>
								<textarea name="questionCommentContent"></textarea>
							</div>
						</li>
						<li>
							<button type="submit">등록</button>
						</li>
					</ul>
				</form>
			</div>
			
			<!-- 댓글 출력 -->
			<th:block th:each="qc : ${q.questionList}" th:if="${qc.questionCommentRef == 0}">
				<ul class="posting-comment">
					<li>
						<span class="material-icons">account_box</span>
					</li>
					<li>
						<p class="comment-info">
							<span th:text="${qc.questionCommentWriter}"></span>
							<span th:text="${qc.questionCommentDate}"></span>
						</p>
						<p class="comment-content" th:text="${qc.questionCommentContent}"></p>
						<div class="input-item first-textarea" style="display:none;" th:if="${session.member != null && session.member.memberId == qc.questionCommentWriter}">
							<textarea name="questionCommentContent"></textarea>
						</div>
						<p class="comment-link">
							<th:block th:if="${session.member != null}">
								<a th:onclick="modifyComment(this, [[${q.questionNo}]], [[${qc.questionCommentNo}]]);">수정</a>
								<a th:onclick="deleteComment([[${q.questionNo}]], [[${qc.questionCommentNo}]])">삭제</a>
							</th:block>
							<a class="recShow">답글달기</a>
						</p>
					</li>	
				</ul>
				<ul class="posting-comment reply" th:each="qcc : ${q.questionList}" th:if="${qcc.questionCommentRef == qc.questionCommentNo}">
					<li>
						<span class="material-icons">subdirectory_arrow_right</span>
						<span class="material-icons">account_box</span>
					</li>
					<li>
						<p class="comment-info">
							<span th:text="${qcc.questionCommentWriter}"></span>
							<span th:text="${qcc.questionCommentDate}"></span>
						</p>
						<p class="comment-content" th:text="${qcc.questionCommentContent}"></p>
						<div class="input-item" style="display: none;" th:if="${session.member != null && session.member.memberId == qcc.questionCommentWriter}">
							<textarea name="questionCommentContent"></textarea>
						</div>
						<p class="comment-link">
							<th:block th:if="${session.member != null && session.member.memberId == qcc.questionCommentWriter}">
								<a th:onclick="modifyComment(this, [[${q.questionNo}]], [[${qcc.questionCommentNo}]]);">수정</a>
								<a th:onclick="deleteComment([[${q.questionNo}]], [[${qcc.questionCommentNo}]]);">삭제</a>													
							</th:block>
						</p>
					</li>	
				</ul>
				
				<div class="inputCommentBox inputRecommentBox" th:if="${session.member != null}">
					<form action="/question/insertComment" method="post">
						<ul>
							<li>
								<span class="material-icons">subdirectory_arrow_right</span>
							</li>	
							<li>
								<input type="hidden" name="questionCommentWriter" th:value="${session.member.memberId}">
								<input type="hidden" name="questionRef" th:value="${q.questionNo}">
								<!-- 대댓글 사용이기 때문에 위쪽 댓글 출력 중 each문의 nc를 가져와 사용 -->
								<input type="hidden" name="questionCommentRef" th:value="${qc.questionCommentNo}">
								<div class="input-item">
									<textarea name="questionCommentContent"></textarea>
								</div>
							</li>
							<li>
								<button type="submit" class="btn-primary">등록</button>
							</li>
						</ul>
					</form>
				</div>
			</th:block>
			
				
		</section>
        <th:block th:include="common/footer"></th:block>
        <script>
        	function deleteQuestion(questionNo){
        		swal({
        			title : "문의사항 삭제",
        			text : "문의사항을 삭제하시겠습니까?",
        			icon : "warning",
        			buttons: {
        				cancel : {
        					text: "취소",
        					value: false,
        					visible: true,
        					className: "btn-button",
        					closeModal: true
        				},
        				confirm: {
        					text: "삭제",
        					value: true,
        					visible: true,
        					className: "btn-a",
        					closeModal: true  					
        				}
        			}
        		}).then(function(isConfirm){
        			if(isConfirm){
        				location.href="/question/delete?questionNo="+questionNo;
        			}
        		})
        	}
        	
        	$(".recShow").on("click", function(){
    			const index = $(".recShow").index(this);
    			if($(this).text === "답글달기"){
    				$(this).text("취소");
    			} else {
    				$(this).text("답글달기");
    			}
    			
    			$(".inputRecommentBox").eq(index).toggle();
    		});
        	
        	function modifyComment(obj, questionNo, questionCommentNo){
        		const questionCommentContent = $(obj).parent().prev().prev().text();
    			//화면에 숨겨둔 textarea에 현재 댓글내용 입력
    			$(obj).parent().prev().children().text(questionCommentContent);
    			//화면에 출력되고있는 현재 댓글 내용을 숨김	
    			$(obj).parent().prev().prev().hide();
    			//화면에 숨겨둔 textarea를 감싼 div를 보여줌
    			$(obj).parent().prev().show();
    			
    			//수정 -> 수정완료
    			$(obj).text("수정완료");
    			$(obj).attr("onclick", "modifyComplete(this, "+questionNo+","+questionCommentNo+")");
    			//취소 -> 수정취소
    			$(obj).next().text("수정취소");
    			$(obj).next().attr("onclick", "modifyCancel(this, "+questionNo+", "+questionCommentNo+")")
    			
    			//답글달기 버튼이 있는 경우 -> 화면에서 숨김
    			$(obj).next().next().hide();
        	}
        	function modifyComplete(obj, questionNo, questionCommentNo){
        		//form태그 생성해서 내부에 필요한 태그들을 작성해서 넣은 후 submit
        		//1. form태그 생성(양식이기 때문에)
        		const form = $("<form>");
        		//1-1. form태그 속성 설정
				form.attr("action", "/question/updateComment");
				form.attr("method", "post");
				form.hide();
        		
        		//2. form태그 내부에 전송하고 싶은 데이터를 input, textarea, select..등의 태그로 삽입(attr 속성으로 추가)
        		const questionCommentNoInput = $("<input>");
        		questionCommentNoInput.attr("type", "text");
        		questionCommentNoInput.attr("name", "questionCommentNo");
        		questionCommentNoInput.val(questionCommentNo);
        		
        		const questionRefInput = $("<input type='text' name='questionRef'>");
        		questionRefInput.val(questionNo);
        		
        		//3. 수정된 댓글이 입력되어있는 textarea를 복사해서 가져옴
				const questionCommentContent = $(obj).parent().prev().children().clone();
        		
        		//4. form태그에 추가
        		form.append(questionCommentNoInput).append(questionRefInput).append(questionCommentContent);
        		
        		//5. form태그를 현재 페이지에 추가
        		$("body").append(form);
        		
        		//6. form submit
        		form.submit();        		
        	}
        	function modifyCancel(obj, questionNo, questionCommentNo){
        		//화면에 보여지고 있는 textarea를 감산 div를 다시 숨김
        		$(obj).parent().prev().hide();
        		//화면에 숨겨놨던 댓글을 출력하는 p태그를 보여줌
        		$(obj).parent().prev().prev().show();
        		
        		//수정완료 -> 수정
    			$(obj).prev().text("수정");
    			$(obj).prev().attr("onclick", "modifyComment(this,"+noticeNo+", "+noticeCommentNo+");");
    			//수정취소 -> 삭제
    			$(obj).text("삭제");
    			$(obj).attr("onclick", "deleteComment("+noticeNo+","+noticeCommentNo+")");
    			//답글달기
    			$(obj).next().show();
        	}
        	
        	function deleteComment(questionNo, questionCommentNo){
        		if(confirm("댓글을 삭제하시겠습니까?")){  			
        			location.href = "/question/deleteComment?questionRef="+questionNo+"&questionCommentNo="+questionCommentNo;
        		}
        	}
        </script>
</body>
</html>













































